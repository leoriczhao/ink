name: Deploy Docs

on:
  push:
    branches: [master]

jobs:
  deploy-docs:
    runs-on: [self-hosted, docs-deploy]
    steps:
      - uses: actions/checkout@v4

      - name: Install tools
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y -qq doxygen graphviz python3-pip
          pip3 install sphinx breathe sphinx-rtd-theme || pip3 install --break-system-packages sphinx breathe sphinx-rtd-theme

      - name: Build docs
        run: |
          mkdir -p docs/_build/doxygen
          doxygen Doxyfile
          sphinx-build -b html docs docs/_build/sphinx

      - name: Deploy
        run: |
          rsync -av --delete docs/_build/sphinx/ /var/www/ink-docs/
